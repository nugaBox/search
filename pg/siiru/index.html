
<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SiiRU</title>
	<link rel="shortcut icon" href="images/favicon.png">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/fontAwesome.min.css">
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.slimscroll.min.js"></script>
	<style>
		body{font-family:'Apple SD Gothic Neo',sans-serif;font-size:1rem;}
		h1{padding-top:10px;font-weight:700;}
		.custom-control{margin-top:5px;}
		.custom-control-label{padding-top:2px;cursor:pointer;}
		.workDs,.wordDs,.tableDs{font-size:.8em;}
	</style>
</head>
<body>
<div class="container-fluid">
	<form id="siiru" name="siiru" method="post" class="form-horizontal">
	<input type="hidden" id="se" name="se" value="">
	<input type="hidden" id="adstrdFile" name="adstrdFile" value="KIKcd_H.20210101.xlsx">
	<input type="hidden" id="legaldongFile" name="legaldongFile" value="KIKcd_B.20210101.xlsx">
	<div class="row licenseLayout">
		<div class="col-12">
			<h1>SiiRU CMS</h1>
			<div class="card">
				<h5 class="card-header"><i class="fad fa-id-card" aria-hidden="true"></i> License</h5>
				<div class="card-body">
					<div class="form-row">
						<label class="col-1 col-form-label text-right">버전</label>
						<div class="col-11">
							<div class="custom-control custom-radio custom-control-inline">
								<input type="radio" id="ver1" name="ver" class="custom-control-input" value="2.1" checked>
								<label class="custom-control-label" for="ver1"> 2.1 </label>
							</div>
							<div class="custom-control custom-radio custom-control-inline">
								<input type="radio" id="ver2" name="ver" class="custom-control-input" value="1.8">
								<label class="custom-control-label" for="ver2"> 1.8 </label>
							</div>
						</div>
					</div>
					<div class="form-row">
						<label for="domain" class="col-1 col-form-label text-right">도메인명</label>
						<div class="col-5">
							<input type="text" class="form-control" id="domain" name="domain" placeholder="여러건은 (^)로 구분" value="" required>
						</div>
						<label for="serverIp" class="col-1 col-form-label text-right">서버IP</label>
						<div class="col-5">
							<input type="text" class="form-control" id="serverIp" name="serverIp" placeholder="여러건은 (^)로 구분" value="" required>
						</div>
					</div>
					<div class="form-row mt-2">
						<label for="company" class="col-1 col-form-label text-right">업체명</label>
						<div class="col-5">
							<input type="text" class="form-control" id="company" name="company" placeholder="환경설정에 정의된 업체명" value="" required>
						</div>
						<label for="limitDt" class="col-1 col-form-label text-right">만료기일</label>
						<div class="col-5">
							<input type="text" class="form-control" id="limitDt" name="limitDt" placeholder="yyyy-MM-dd" value="">
						</div>
					</div>
					<div class="form-row mt-2">
						<label for="license" class="col-1 col-form-label text-right">라이센스명</label>
						<div class="col-11">
							<input type="text" class="form-control" id="license" name="license" placeholder="서버용" value="서버용" required>
						</div>
					</div>
				</div>
				<div class="card-footer">
					<div class="row">
						<div class="col-10">
							<div class="licenseDs alert alert-secondary mb-0" role="alert">&nbsp;</div>
						</div>
						<div class="col-2 text-right">
							<button type="button" class="btn btn-primary btn-lg"><i class="far fa-user-secret"></i> Create</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row mt-3 unicodeLayout">
		<div class="col-12">
			<div class="card">
				<h5 class="card-header"><i class="fad fa-code" aria-hidden="true"></i> UniCode</h5>
				<div class="card-body">
					<div class="form-row">
						<label for="kor" class="col-1 col-form-label text-right">한글</label>
						<div class="col-11">
							<div class="input-group">
								<input type="text" class="form-control" id="kor" name="kor" value="">
								<div class="input-group-append">
									<button type="button" class="btn btn-secondary" data-action="K"><i class="far fa-exchange-alt"></i> 변환</button>
								</div>
							</div>
						</div>
					</div>
					<div class="form-row mt-2">
						<label for="unicode" class="col-1 col-form-label text-right">UniCode</label>
						<div class="col-11">
							<div class="input-group">
								<input type="text" class="form-control" id="unicode" name="unicode" value="">
								<div class="input-group-append">
									<button type="button" class="btn btn-secondary" data-action="U"><i class="far fa-exchange-alt"></i> 변환</button>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="card-footer">
					<div class="row">
						<div class="col-12">
							<div class="unicodeDs alert alert-secondary mb-0" role="alert">&nbsp;</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row mt-3 wordLayout">
		<div class="col-12">
			<div class="card">
				<h5 class="card-header"><i class="fad fa-spell-check" aria-hidden="true"></i> Dictionary</h5>
				<div class="card-body">
					<div class="form-row">
						<div class="col-11 offset-1">
							<div class="custom-control custom-switch custom-control-inline">
								<input type="checkbox" class="custom-control-input" id="word" name="word" value="Y">
								<label class="custom-control-label" for="word"> WORD </label>
							</div>
							<div class="custom-control custom-switch custom-control-inline">
								<input type="checkbox" class="custom-control-input" id="wordEng" name="wordEng" value="Y">
								<label class="custom-control-label" for="wordEng"> WORD ENG </label>
							</div>
							<div class="custom-control custom-switch custom-control-inline">
								<input type="checkbox" class="custom-control-input" id="wordAbrv" name="wordAbrv" value="Y">
								<label class="custom-control-label" for="wordAbrv"> WORD ABRV </label>
							</div>
						</div>
					</div>
					<div class="form-row mt-2">
						<label for="keyword" class="col-1 col-form-label text-right">키워드</label>
						<div class="col-11">
							<div class="input-group">
								<input type="text" class="form-control" id="keyword" name="keyword" value="">
								<div class="input-group-append">
									<button type="button" class="btn btn-secondary" data-action="DIC"><i class="far fa-search"></i> 검색</button>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="card-footer">
					<div class="row">
						<div class="col-12">
							<div class="alert alert-secondary mb-0" role="alert"><pre class="wordDs"></pre></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row mt-3 utils">
		<div class="col-12">
			<div class="card">
				<h5 class="card-header"><i class="fad fa-tools" aria-hidden="true"></i> Utils</h5>
				<div class="card-body">
					<ul class="list-group">
			 			<li class="list-group-item">
							ip2nation <small><a href="http://www.ip2nation.com/" target="_blank">ip2nation</a></small>
							<kbd>Latest version : May 25, 2020</kbd>
							<button type="button" class="float-right btn btn-secondary btn-sm" data-action="SI"><i class="far fa-code"></i> Create SQL</button>
			 			</li>
						<li class="list-group-item">
							법정동/행정동 <small><a href="https://www.mois.go.kr/frt/bbs/type001/commonSelectBoardList.do?bbsId=BBSMSTR_000000000052" target="_blank">[행정안전부] 주민등록,인감,행정사</a></small>
							<kbd>주민등록 주소 코드 변경 (2021.01.01.시행)</kbd>
							<button type="button" class="float-right btn btn-secondary btn-sm" data-action="SD"><i class="far fa-code"></i> Create SQL</button>
			 			</li>
						<li class="list-group-item">
							YAML <small><a href="https://github.com/ua-parser/uap-core" target="_blank">ua-parser / uap-core</a></small>
							<kbd>Add support for DuckDuckGo Mobile, Jan 13, 2021</kbd>
			 			</li>
						<li class="list-group-item">
							Font Awesome <small><a href="https://fontawesome.com/" target="_blank">Font Awesome</a></small>
							<kbd>admin@comin.com / com0618@@</kbd>
			 			</li>
						<li class="list-group-item">
							SiiRU CMS 운영자 메뉴얼 v2.1
							<button type="button" class="float-right btn btn-secondary btn-sm" data-action="DM"><i class="far fa-eye"></i> View</button>
			 			</li>
					</ul>
				</div>
				<div class="card-footer">
					<div class="row">
						<div class="col-12">
							<div class="alert alert-secondary mb-0" role="alert"><pre class="workDs"></pre></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row mt-3 mb-5 tableLayout">
		<div class="col-12">
			<div class="card">
				<h5 class="card-header"><i class="fad fa-database" aria-hidden="true"></i> Table</h5>
				<div class="card-body">
					<div class="form-row">
						<label class="col-1 col-form-label text-right">버전</label>
						<div class="col-5">
							<div class="custom-control custom-radio custom-control-inline">
								<input type="radio" id="tableVer1" name="tableVer" class="custom-control-input" value="2.1" checked>
								<label class="custom-control-label" for="tableVer1"> 2.1 </label>
							</div>
							<div class="custom-control custom-radio custom-control-inline">
								<input type="radio" id="tableVer2" name="tableVer" class="custom-control-input" value="1.8">
								<label class="custom-control-label" for="tableVer2"> 1.8 </label>
							</div>
						</div>
						<label class="col-1 col-form-label text-right">DB Type</label>
						<div class="col-5">
							<div class="custom-control custom-radio custom-control-inline">
								<input type="radio" id="dbType1" name="dbType" class="custom-control-input" value="oracle">
								<label class="custom-control-label" for="dbType1"> Oracle </label>
							</div>
							<div class="custom-control custom-radio custom-control-inline">
								<input type="radio" id="dbType2" name="dbType" class="custom-control-input" value="tibero">
								<label class="custom-control-label" for="dbType2"> Tibero </label>
							</div>
							<div class="custom-control custom-radio custom-control-inline">
								<input type="radio" id="dbType3" name="dbType" class="custom-control-input" value="mariadb">
								<label class="custom-control-label" for="dbType3"> MariaDB </label>
							</div>
							<div class="custom-control custom-radio custom-control-inline">
								<input type="radio" id="dbType4" name="dbType" class="custom-control-input" value="mysql">
								<label class="custom-control-label" for="dbType4"> MySQL </label>
							</div>
						</div>
					</div>
					<div class="form-row mt-2">
						<label for="host" class="col-1 col-form-label text-right">Host</label>
						<div class="col-5">
							<input type="text" class="form-control" id="host" name="host" placeholder="Host" value="" required>
						</div>
						<label for="port" class="col-1 col-form-label text-right">Port</label>
						<div class="col-5">
							<input type="text" class="form-control" id="port" name="port" placeholder="Port [1521, 3306]" value="" required>
						</div>
					</div>
					<div class="form-row mt-2">
						<label for="userName" class="col-1 col-form-label text-right">User</label>
						<div class="col-5">
							<input type="text" class="form-control" id="userName" name="userName" placeholder="UserName" value="" required>
						</div>
						<label for="password" class="col-1 col-form-label text-right">Pass</label>
						<div class="col-5">
							<input type="password" class="form-control" id="password" name="password" placeholder="Password" value="" required>
						</div>
					</div>
					<div class="form-row mt-2">
						<label for="sid" class="col-1 col-form-label text-right">SID</label>
						<div class="col-5">
							<input type="text" class="form-control" id="sid" name="sid" placeholder="SID or DataBase" value="" required>
						</div>
						<div class="col-6 text-right">
							<div class="btn-group">
								<button type="button" class="btn btn-warning" data-action="TT"><i class="far fa-tasks"></i> 컬럼 검사</button>
								<button type="button" class="btn btn-danger" data-action="TC"><i class="far fa-not-equal"></i> 테이블 비교</button>
								<button type="button" class="btn btn-secondary" data-action="TF"><i class="far fa-code"></i> 테이블 비교파일</button>
								<button type="button" class="btn btn-success" data-action="TD"><i class="far fa-download"></i> 테이블 명세서</button>
							</div>
						</div>
					</div>
				</div>
				<div class="card-footer">
					<div class="row">
						<div class="col-12">
							<div class="alert alert-secondary mb-0" role="alert"><pre class="tableDs"></pre></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	</form>
</div>
<script type="text/javascript">
	$(document).ready(function() {
		// 출력폼
		$('.workDs,.wordDs').slimScroll({height:'100px',start:'bottom'});
		$('.tableDs').slimScroll({height:'200px',start:'bottom'});
		// DB Type 선택시
		$(':radio[name="dbType"]').change(function() {
			$('#host').val('');
			$('#port').val('');
			$('#userName').val('');
			$('#password').val('');
			$('#sid').val('');
			if ($.trim($(this).val()) == 'oracle') {
				$('#host').val('192.168.1.203');
				$('#port').val('1521');
				$('#userName').val('siiru');
				$('#password').val('rkals1q@W');
				$('#sid').val('orcl');
			} else if ($.trim($(this).val()) == 'tibero') {
				$('#host').val('192.168.1.201');
				$('#port').val('18629');
				$('#userName').val('city2020');
				$('#password').val('city2020');
				$('#sid').val('GJDB');
			} else if ($.trim($(this).val()) == 'mariadb') {
				$('#host').val('192.168.1.203');
				$('#port').val('3306');
				$('#userName').val('siiru');
				$('#password').val('rkals1q@W');
				$('#sid').val('siiru');
			} else if ($.trim($(this).val()) == 'mysql') {
				$('#host').val('192.168.1.203');
				$('#port').val('3309');
				$('#userName').val('siiru');
				$('#password').val('rkals1q@W');
				$('#sid').val('siiru');
			}
		});
		$(':radio[name="dbType"][value="oracle"]').prop('checked', true).trigger('change');
		// License
		$('.licenseLayout .btn').click(function() {
			$('#se').val('L');
			ajaxForm(function(data) {
				// 오류
				if (data.err == 'Y') {
					$('.licenseDs').html('<span class="text-danger">'+$.trim(data.errMsg)+'</span>');
				// 생성
				} else {
					$('.licenseDs').html('<span class="text-success">'+$.trim(data.dataArr.licenseDs)+'</span>');
				}
			});
		});
		// UniCode
		$('.unicodeLayout .btn').click(function() {
			var str = '';
			if ($(this).data('action') == 'K') {
				if ($.trim($('#kor').val()) != '') {
					str = escape($.trim($('#kor').val()));
					str = str.split("%").join("\\");
					str = str.split("\\20").join(" ");
					$('.unicodeDs').html('<span class="text-success">'+$.trim(str)+'</span>');
				}
			} else {
				if ($.trim($('#unicode').val()) != '') {
					str = $.trim($('#unicode').val());
					str = unescape(str.split("\\").join("%"));
					$('.unicodeDs').html('<span class="text-success">'+$.trim(str)+'</span>');
				}
			}
		});
		// Dictionary
		$('.wordLayout .btn').click(function() {
			var action = $(this).data('action');
			$('#se').val(action);
			$(this).prepend('<em class="load"><i class="fad fa-spinner fa-spin fa-fw"></i></em> ');
			$('.wordDs').text('');
			ajaxForm(function(data) {
				var wordDs = '';
				var color = 'danger';
				if ($.trim(data.err) == 'N') {
					color = 'success';
					$.each(data.dataArr, function(key, values) {
						wordDs+= $.trim(values.word)+' / ';
						wordDs+= $.trim(values.wordEng)+' / ';
						wordDs+= $.trim(values.wordAbrv)+' ';
						wordDs+= '['+$.trim(values.dfn)+']'+'\n';
					});
				} else {
					wordDs = $.trim(data.errMsg)+'\n';
					color = 'danger';
				}
				$('.wordDs').append('<span class="text-'+color+'">'+wordDs+'</span>');
				$('.wordDs').slimscroll({scrollBy: $('.wordDs').prop('scrollHeight')+'px'});
				$('.wordLayout .btn em.load').remove();
			});
		});
		// Utils
		$('.utils .btn').click(function() {
			var action = $(this).data('action');
			if (action == 'DM') {
				window.open('source/SiiRUCMS.v2.1.pdf');
			} else {
				scrollMove($('.utils .card-footer'));
				$('#se').val(action);
				$(this).prepend('<em class="load"><i class="fad fa-spinner fa-spin fa-fw"></i></em> ');
				ajaxForm(function(data) {
					$.each(data.dataArr, function(key, values) {
						$('.workDs').append($.trim(values.workDs)+'\n');
					});
					$('.workDs').slimscroll({scrollBy: $('.workDs').prop('scrollHeight')+'px'});
					$('.utils .btn em.load').remove();
				});
			}
		});
		// Table
		$('.tableLayout .btn').click(function() {
			var action = $(this).data('action');
			$('#se').val(action);
			if (action == 'TD') {
				$('#siiru').attr('action','doc.php').submit();
			} else if (action == 'TF') {
				$(this).prepend('<em class="load"><i class="fad fa-spinner fa-spin fa-fw"></i></em> ');
				$.get('json.php?mode='+$(':radio[name="dbType"]:checked').val(), function() {
					$('.tableLayout .btn em.load').remove();
				});
			} else if (action == 'TT') {
				$(this).prepend('<em class="load"><i class="fad fa-spinner fa-spin fa-fw"></i></em> ');
				scrollMove($('.tableLayout .card-footer'));
				ajaxForm(function(data) {
					var tableDs = '';
					var color = 'danger';
					if ($.trim(data.err) == 'N') {
						var map = data.dataArr;
						$.each(map, function(key, values) {
							if ($.trim(values.ty) == 'TC' || $.trim(values.ty) == 'CC') {
								tableDs+= $.trim(values.view)+'\n';
							} else {
								tableDs+= $.trim(values.view)+'\n';
								$.each(values.list, function(dKey, dValues) {
									tableDs+= '    ';
									tableDs+= '['+$.trim(dValues.tcmt)+'] '+$.trim(dValues.tname)+' : ';
									tableDs+= '['+$.trim(dValues.comments)+'] '+$.trim(dValues.columnName);
									tableDs+= ' '+$.trim(dValues.dataType)+' '+$.trim(dValues.nullable)+' '+$.trim(dValues.dataDefault)+'\n';
								});
							}
						});
						if (map.length == 0) {
							tableDs = '코멘트, 타입이 정상적으로 매핑되어 있습니다.\n';
							color = 'success';
						}
					} else {
						tableDs = $.trim(data.errMsg)+'\n';
						color = 'danger';
					}
					$('.tableDs').append('<span class="text-'+color+'">'+tableDs+'</span>');
					$('.tableDs').slimscroll({scrollBy: $('.tableDs').prop('scrollHeight')+'px'});
					$('.tableLayout .btn em.load').remove();
				});
			} else {
				$(this).prepend('<em class="load"><i class="fad fa-spinner fa-spin fa-fw"></i></em> ');
				scrollMove($('.tableLayout .card-footer'));
				ajaxForm(function(data) {
					if ($.trim(data.err) == 'N') {
						var map = data.dataArr;
						var tableMsg = '';
						var procedureMsg = '';
						var functionMsg = '';
						var tableDs = '';
						var color = '';
						if (map.tableCnt == 0 && map.procedureCnt == 0 && map.functionCnt == 0) {
							tableDs = '정상적으로 매핑되어 있습니다.\n';
							color = 'success';
						} else {
							if (map.tableCnt > 0) tableMsg = '==== TABLE : '+numberWithCommas(map.tableCnt)+'\n';
							if (map.procedureCnt > 0) procedureMsg = '==== PROCEDURE : '+numberWithCommas(map.procedureCnt)+'\n';
							if (map.functionCnt > 0) functionMsg = '==== FUNCTION : '+numberWithCommas(map.functionCnt)+'\n';
							$.each(map.list, function(key, values) {
								if ($.trim(values.objTy) == 'TABLE') {
									tableMsg+= '  '+$.trim(values.objNm)+'['+$.trim(values.objComment)+']\n';
									tableMsg+= '      '+$.trim(values.objMsg)+'\n';
								} else if ($.trim(values.objTy) == 'PROCEDURE') {
									procedureMsg+= '  '+$.trim(values.objNm)+'['+$.trim(values.objComment)+'] : '+$.trim(values.objMsg)+'\n';
								} else if ($.trim(values.objTy) == 'FUNCTION') {
									functionMsg+= '  '+$.trim(values.objNm)+'['+$.trim(values.objComment)+'] : '+$.trim(values.objMsg)+'\n';
								}
							});
							tableDs = tableMsg + procedureMsg + functionMsg;
							color = 'danger';
						}
					} else {
						tableDs = $.trim(data.errMsg)+'\n';
						color = 'danger';
					}
					$('.tableDs').append('<span class="text-'+color+'">'+tableDs+'</span>');
					$('.tableDs').slimscroll({scrollBy: $('.tableDs').prop('scrollHeight')+'px'});
					$('.tableLayout .btn em.load').remove();
				});
			}
		});
	});
	// 화면 이동
	function scrollMove(obj) {
		var scmove = obj.offset().top;
		$('html, body').animate({scrollTop : scmove}, 'slow');
	}
	// 숫자 3자리 단위마다 콤마(comma)
	function numberWithCommas(x) {
		return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
	}
	// ajax 전송
	function ajaxForm(outData) {
		$.ajax({
			type : 'post',
			url : 'action.php',
			data : $('#siiru').serialize(),
			dataType : 'json',
			success : function(data) {
				outData(data);
			}
		});
	}
</script>
</body>
</html>
